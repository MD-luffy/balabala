$.fn.balabala=function(a){function b(){for(var a=.15*$(window).width(),b=.25*$(window).height(),c=parseInt(.5*$(window).height()-78),d=.7*$(window).width()/3;c%3;)c++;$(".date-picker").css("left",a),$(".date-picker").css("top",b),$(".date-s").css("height",c),$(".date-s-com").css("width",d),$(".date-s-y").css("left",0),$(".date-s-m").css("left",d),$(".date-s-d").css("left",2*d),$(".date-s-u li").css("height",c/3),$(".date-s-u li").css("line-height",c/3+"px"),window.balabalaTop=$(".date-s").offset().top+parseFloat($(".date-s-u li").css("height")),window.balabalaItemHeight=parseInt($(".date-s-u li").css("height"))}function c(a){function b(){$(document).off(".bala"),$(".date-picker").remove(),$(".date-mask").remove()}var c=0,e=a.callback||"";$(document).on("touchmove.bala",function(a){a.preventDefault()}),$(document).on("touchmove.bala",".date-s-y, .date-s-m, .date-s-d",function(a){function b(a,b,d){var g,f=parseFloat(a.css("-webkit-transform").substring(11));f<1.3*window.balabalaItemHeight&&f>window.balabalaItemHeight*(2-b)-.3*window.balabalaItemHeight&&(g=d+e-c,g>1.3*window.balabalaItemHeight?g=1.3*window.balabalaItemHeight:g<window.balabalaItemHeight*(2-b)-.3*window.balabalaItemHeight&&(g=window.balabalaItemHeight*(2-b)-.3*window.balabalaItemHeight),a.css("-webkit-transform","translateY("+g+"px)"))}var d=a.target,e=a.touches[0].screenY;$(d).closest("div").hasClass("date-s-y")?b($(".date-s-y ul"),window.balabalaYears,window.moveYears):$(d).closest("div").hasClass("date-s-m")?b($(".date-s-m ul"),window.balabalaMonths,window.moveMonths):b($(".date-s-d ul"),window.balabalaDays,window.moveDays)}),$(document).on("touchstart.bala",".date-s",function(a){c=a.touches[0].screenY}),$(document).on("touchend.bala",".date-s",function(a){function b(a){var b=parseFloat(a.css("-webkit-transform").substring(11)),c=b%window.balabalaItemHeight;return Math.abs(c)<window.balabalaItemHeight/2?a.css("-webkit-transform","translateY("+(b-c)+"px)"):a.css("-webkit-transform","translateY("+(0>c?b-(window.balabalaItemHeight-Math.abs(c)):b+(window.balabalaItemHeight-Math.abs(c)))+"px)"),parseInt(a.css("-webkit-transform").substring(11))}function c(){function a(a,b,c){if(d(a+"-"+b+"-"+c),$(".date-s-d ul li").length>window.balabalaDays)for(;$(".date-s-d ul li").length-window.balabalaDays;)parseInt(c)>window.balabalaDays&&$(".date-s-d ul").css("-webkit-transform","translateY("+(window.moveDays+window.balabalaItemHeight)+"px)"),$(".date-s-d ul li").last().remove(),window.moveDays=parseInt($(".date-s-d ul").css("-webkit-transform").substring(11));else for(;window.balabalaDays-$(".date-s-d ul li").length;)$(".date-s-d ul").append('<li id="days-'+($(".date-s-d ul li").length+1)+'" style="'+$(".date-s-d ul li").attr("style")+'">'+($(".date-s-d ul li").length+1)+"</li>");var e=window.moveDays%window.balabalaItemHeight?0:2-window.moveDays/window.balabalaItemHeight;return $($(".date-s-d ul li")[e-1]).html()}var b=window.moveYears%window.balabalaItemHeight?0:2-window.moveYears/window.balabalaItemHeight,c=window.moveMonths%window.balabalaItemHeight?0:2-window.moveMonths/window.balabalaItemHeight,e=window.moveDays%window.balabalaItemHeight?0:2-window.moveDays/window.balabalaItemHeight,f=$($(".date-s-y ul").children()[b-1]).html(),g=$($(".date-s-m ul").children()[c-1]).html(),h=$($(".date-s-d ul").children()[e-1]).html();return h=a(f,g,h),console.log("year: %s, month: %s, day: %s",f,g,h),f+"-"+g+"-"+h}var e=a.target;$(e).closest("div").hasClass("date-s-y")?window.moveYears=b($(".date-s-y ul")):$(e).closest("div").hasClass("date-s-m")?window.moveMonths=b($(".date-s-m ul")):window.moveDays=b($(".date-s-d ul")),$(".date-a").html(c())}),$(".date-c-ok").on("click.bala",function(){0==window.balabalaEvr?$('[balabala-attr="begin-date"]').html($(".date-a").html()):($('[balabala-attr="end-date"]').html($(".date-a").html()),e&&e()),b()}),$(".date-c-no").on("click.bala",function(){b()})}function d(a){var b=a.split("-")[0],c=a.split("-")[1];a.split("-")[2],window.balabalaDays=2==parseInt(c)?0!=parseInt(b)%100&&0==parseInt(b)%4||0==parseInt(b)%400?29:28:0==parseInt(c)%2?parseInt(c)<=7?30:31:parseInt(c)<=7?31:30}function e(a){function b(a){var b=new Date,c={year:function(){var a,c;for(a=1;a<=window.balabalaYears;a++)c=b.getFullYear()-window.balabalaYears+a,$(".date-s-y ul").append('<li id="years-'+a+'">'+c+"</li>")},month:function(){var a,b;for(a=1;a<=window.balabalaMonths;a++)b=10>a?"0"+a:a,$(".date-s-m ul").append('<li id="months-'+a+'">'+b+"</li>")},day:function(){var b,c;for(d(a),b=1;b<=window.balabalaDays;b++)c=10>b?"0"+b:b,$(".date-s-d ul").append('<li id="days-'+b+'">'+c+"</li>")}};c.year(),c.month(),c.day()}0==window.balabalaEvr?($("div.date-a").html(a),b(a)):(b(a),$("div.date-a").html(a))}function f(a){$(".date-picker").css("color",a.theme||"#31b6e7"),$(".date-a, .date-s-u li").css("border-bottom",a.theme?"2px solid "+a.theme:"2px solid #31b6e7")}function g(a){function g(a,c){var f,g,d=a.length,e=a.first();for(f=1;d>=f;f++){if($(e).html()==c)return g=(2-f)*parseFloat(b),a.parent().css("-webkit-transform","translateY("+g+"px)"),g;e=$(e).next()}}var b=$(".date-s-u li").css("height"),c=$(".date-s-y ul li"),d=$(".date-s-m ul li"),e=$(".date-s-d ul li"),f={year:function(){window.moveYears=g(c,a.split("-")[0])},month:function(){window.moveMonths=g(d,a.split("-")[1])},day:function(){window.moveDays=g(e,a.split("-")[2])}};f.year(),f.month(),f.day()}function h(){var a=[];a.push('<div class="date-picker">','<div class="date-a"></div>','<div class="date-s">','<div class="date-s-com date-s-y">','<ul class="date-s-u"></ul>',"</div>",'<div class="date-s-com date-s-m">','<ul class="date-s-u"></ul>',"</div>",'<div class="date-s-com date-s-d">','<ul class="date-s-u"></ul>',"</div>","</div>",'<div class="date-c">','<div class="date-c-com date-c-ok">确定</div>','<div class="date-c-com date-c-no">取消</div>',"</div>","</div>",'<div class="date-mask"></div>'),$("body").append(a.join(""))}function i(a){function d(){var j,a=Number(arguments[0]||0),b=new Date,c=b.getFullYear(),d=b.getMonth(),e=b.getDate(),f=new Date(c,d,e+a),g=f.getFullYear(),h=f.getMonth()+1,i=f.getDate();return h=10>h?"0"+h:h,i=10>i?"0"+i:i,j=g+"-"+h+"-"+i}$('[balabala-attr="begin-date"]').html(a.beginDay?a.beginDay:d("-8")),$('[balabala-attr="end-date"]').html(a.endDay?a.endDay:d("-1")),$(".balabala-select").on("click",function(d){var i=d.target,j="begin-date"==$(i).attr("balabala-attr")?$('[balabala-attr="begin-date"]').html():$('[balabala-attr="end-date"]').html();window.balabalaEvr="begin-date"==$(i).attr("balabala-attr")?0:1,h(),e(j),f(a),b(),g(j),c(a)})}window.balabalaYears=30,window.balabalaMonths=12,window.balabalaDays=0,window.moveYears,window.moveMonths,window.moveDays,window.balabalaTop,window.balabalaItemHeight,window.balabalaEvr,i(a)};